(function e(t,r,n,o,i,a,s){"use strict";var u;var l=r.create;var c=l(null);var p=r.defineProperty;var f=r.defineProperties;var d=r.freeze;var v=r.seal;var _=r.preventExtensions;var h=r.isFrozen;var y=r.isSealed;var b=r.isExtensible;var m=r.getOwnPropertyNames;var g=r.getOwnPropertySymbols;var w=r.getOwnPropertyDescriptor;var C=r.getPrototypeOf;var P=r.setPrototypeOf;var j=o.iterator;var S=Math.ceil;var E=Math.max;var M=Math.min;var k=l(null);var x=l(null);var R=l(c);var D={enumerable:false,writable:false,configurable:false,__proto__:c};var O=r.prototype;var T=n.prototype;var q=i.prototype;var J=a.prototype;var I=s.prototype;var B={get:A,set:N,__proto__:null};function A(){return C(this)}function N(e){P(this,e)}var F=O.hasOwnProperty;var H=T.call;var L=T.apply;var U=T.bind;var W=q.map;var z=J.set;var X=J.get;var Q=J.delete;var Y=J.forEach;var G=I.add;var V=I.delete;var K=I.forEach;var Z=U.bind(U);var $=Z(H);var ee=$(W);var te=$(ct);var re=$(pt);var ne=$(vt);var oe=$(yt);var ie=$(ht);var ae=Z(ct);var se=new a;var ue=new a;var le=z.bind(se);var ce=X.bind(se);var pe=z.bind(ue);var fe=X.bind(ue);function de(e,t){le(e,new s);e.prototype=t}function ve(e,t){var r=se.get(e);if(r.has(t))throw new TypeError("Can't re-construct object. 'new' operator is required.");r.add(t)}function _e(e,t,r){if(!he(e,t))throw new TypeError(r)}function he(e,t){var r=ce(e);return r&&r.has(t)}function ye(e,t,r,n,o){if(!this)return new ye(e,t,r,n,o);var i=ae(this);i("get",function a(){return e[t]});r||i("set",function s(r){e[t]=r});i("enumerable",Boolean(n));i("configurable",Boolean(o))}ye.prototype=d({get:null,set:null,readonly:false,enumerable:false,configurable:false,__proto__:null});function be(e,t,r){var n=ae(e);ee(t,function o(e){n(e,r)})}function me(e,t){return e[t].bind(e)}function ge(e,t,r){te(e,r,me(t,r))}function we(e,t,r,n){var o=ae(e);var i=me(r,n);o(t,i);o(n,i)}function Ce(e,t,r,n,o,i,a){p(e,t,new ye(r,n,o,i,a))}var Pe=false;function je(e,t,r,n,o,i){p(e,t,{set:n?u:Pe?Ee(r):ke(e,r),get:Pe?Me(r):xe(e,r),enumerable:Boolean(o),configurable:Boolean(i),__proto__:null})}function Se(e,t,r,n,o){p(e,t,{configurable:Boolean(o),enumerable:Boolean(n),get:function(){return this[r]},set:function(e){this[r]=e},__proto__:null})}function Ee(e){return function t(r){return this[e]=r}}function Me(e){return function t(){return this[e]}}function ke(e,t){return function r(n){return e[t]=n}}function xe(e,t){return function r(){return e[t]}}function Re(){return this.user_manuals.join("\n	")}Re.toString=Re;Re.user_manuals="This method which called 'toString', simply join the value stored in 'object.user_manuals' as an instance of 'Array'";function De(e,t){throw new e(t)}function Oe(e){return e&&typeof e==="object"&&b(e)}function Te(e){switch(e){case u:case null:return false}if(typeof e.call==="function"&&typeof e.apply==="function"&&typeof e.bind==="function")return true}var qe=null;var Je=o("Initor");var Ie=o("SymbolCollection");var Be=o("FunctionCollection");var Ae=o("ReleaseMethods");var Ne=o("ReleaseClasses");var Fe=o("ClassCollection");var He=o("created instance");var Le=o("__proto__");var Ue=o("primitive prototype");var We=o("create");var ze=o("setConst");var Xe=o("addSetConsts");var Qe=o("addDefPro");var Ye=o("add member");var Ge=o("remove member");var Ve=o("clear all members");var Ke=o("update and run");var Ze=o("request");var $e=o("unrequest");var et=o("enable");var tt=o("disable");var rt=o("check if enabled, set enable/disable");var nt=o("arguments");var ot=o("self");var it=o("key as Symbol or String");var at=o("jump as Integer");var st=l(q);st.length=0;var ut=d({Initor:Je,SymbolCollection:Ie,FunctionCollection:Be,ReleaseMethods:Ae,ReleaseClasses:Ne,ClassCollection:Fe,createdInstance:He,proto:Le,primitivePrototype:Ue,create:We,setConst:ze,addSetConsts:Xe,addDefPro:Qe,addMember:Ye,removeMember:Ge,clear:Ve,update:Ke,request:Ze,unrequest:$e,enable:et,disable:tt,enabled:rt,args:nt,self:ot,jump:at,__proto__:null});var lt=d({is_extensible_object:Oe,is_valid_handler:Te,Initor:It,SymbolCollection:jt,FunctionCollection:Et,ReleaseClasses:Rt,ReleaseMethods:kt,shared_toString:Re,_prvEnsureConstructor:_e,_prvCheckConstructorInstance:he,_proto_descriptor:(B.set(null),d(B)),_proto_getter:A,_proto_setter:N,_DescriptorGetterSetter1os3b:ye,_setconst1oVs1v:be,_bindmtdbyname:me,_setmtdfromcore2o1s:ge,_setmtdfromcore2os:we,_setkeytokey2os3b:Ce,_setkeytokey1o2s3b:je,_setkeytokey1o2s3b_inheritable:function(e){Pe=Boolean(e)},_defgettersetter1o2s:Se,_setter:Ee,_getter:Me,_setter_of:ke,_getter_of:xe,__function_callbind:$,__setConst:te,__addSetConsts:re,__insertPropertyMapperBefore:ne,__executePropertyMappers:oe,__clearAllPropertyMappers:ie,__proto__:null});function ct(e,t,r){(r||(r=D)).value=t;p(this,e,r);return this}k[ze]=k._kJs_setConst=ct;ct.toString=Re;ct.user_manuals=["void Dictionary::setConst(String name, String value, optional DataPropertyDescriptor descriptor);"];function pt(e,t,r){if(!Oe(this)&&typeof this!=="function")throw new TypeError("Object must be extensible.");var n=this;return ne(e,function(e){var r=e[it];te(n,r,this[r],t)},r)}k[Xe]=k._kJs_addSetConsts=pt;pt.toString=Re;pt.user_manuals=["void Dictionary::addSetConsts(Dictionary clone_target, optional Object descriptor, optional PropertyMapper position)","typedef function<Dictionary, PropertyMapperParam> PropertyMapper;","What this method does is adding a setting-constant handler before position","Call _kJs_insertPropertyMapperBefore.call(clone_target) to apply"];function ft(e,t){if(!Oe(this)&&typeof this!=="function")throw new TypeError("Object must be extensible.");var r=this;return ne(e,function(t){var n=t[it];p(r,n,w(e,n))},t)}k[Qe]=k._kJs_addDefPro=ft;ft.toString=Re;ft.user_manuals=["void Dictionary::addDefPro(Dictionary clone_target, optional PropertyMapper position);","typedef function<Dictionary, PropertyMapperParam> PropertyMapper;","copy all own properties from clone_target to the object by getting their property-descriptor","Call _kJs_insertPropertyMapperBefore.call(clone_target) to apply"];var dt=new a;function vt(e,t){var r=dt.get(this);r?r.some(function(r,n,o){if(t===e){o.splice(n,0,e);return true}else return false})||r.push(e):dt.set(this,[e]);return this}k._kJs_insertPropertyMapperBefore=vt;vt.toString=Re;vt.user_manuals=["void Dictionary::insertPropertyMapperBefore(PropertyMapper handler, optional PropertyMapper position);","typedef function<Dictionary, PropertyMapperParam> PropertyMapper;","When call _kJs_executePropertyMappers, 'handler' will be called before 'position' is called","Handler may skip the rest of executing handler list by assigning arguments[0].jump to 1","Handler may stop the executing process by assigning arguments[0].jump to 2"];function _t(e){var t=dt.get(this);t&&t.splice(t.indexOf(e),1);return this}k._kJs_removePropertyMapper=_t;_t.toString=Re;_t.user_manuals=["void Dictionary::removePropertyMapper(Handler handler)","removed handler would not execute when call _kJs_executePropertyMappers"];function ht(){var e=dt.get(this);if(e)e.length=0;return this}k._kJs_clearAllPropertyMappers=ht;ht.toString=Re;ht.user_manuals=["void Dictionary::clearAllPropertyMappers();","clear all inserted property mappers"];function yt(e){var t=dt.get(this);var r=new bt(e,this);qe=r;if(t){if(!e)e=this;if(g(this).some(n)||m(this).some(n))return this;function n(n){r[it]=n;t.some(o,e);return r[at]>0&&(--r[-key_jump],true)}function o(e,t){e.call(this,r);return r[at]>0&&(--r[at],true)}}return this}k._kJs_executePropertyMappers=yt;yt.toString=Re;yt.user_manuals=["void Dictionary::executePropertyMappers(optional Object args);","execute all handlers which have been inserted before","Handler may skip the rest of executing handler list by assigning arguments[0].continue to true","Handler may stop the executing process by assigning arguments[0].break to true"];function bt(e,t){this[nt]=e;this[ot]=t}(function(e){var t=k._kJs_prvPropertyMapperParam_prototype=e.prototype=l(c);Pe=true;je(t,"args",nt);je(t,"self",ot);je(t,"property",it);je(t,"jump",at);t[nt]=null;t[ot]=null;t[it]=null;t[at]=0})(bt);function mt(e,t){this.object=e;this.handler=t;var r=this.unrequested=new s;this.__add=G.bind(r);this.__delete=V.bind(r);pe(e,this)}mt.prototype=l({__add:null,__delete:null,_add:function(e){this.__add(e)},_remove:function(e){this.__delete(e)},object:null,handler:null,unrequested:null,add:function(e){_e(Ct,e,"arguments[0] is not an instance of Civilian");fe(e)._enter(this);return this.object},remove:function(e){_e(Ct,e,"arguments[0] is not an instance of Civilian");fe(e)._leave(this);return this.object},execute:function(){return this.handler(this.unrequested.size)},__proto__:null});function gt(e){if(!Oe(this))return new gt(e);if(!Te(e))throw new TypeError("arguments[0] is not a valid handler.");e=e.bind(this);if(typeof e!=="function")throw new TypeError("handler.bind() must return a function.");ve(gt,this);var t=new mt(this,e);we(this,Ye,t,"add");we(this,Ge,t,"remove");we(this,Ke,t,"execute")}de(gt,function Bt(e){var t=ae(e);t("add",null);t("remove",null);t("execute",null);t(Ye,null);t(Ge,null);t(Ke,null);return e}(l(c)));x._kJs_Republic=R.Republic=gt;gt.toString=Re;gt.user_manuals=["constructor Republic(function<void, Republic, uint> handler);","void add(Civilian civilian);","void remove(Civilian civilian);","any execute();"];(function At(e){var t=ae(e);t("EXECUTE_CASE_ALL_OR_NO",function(e,t){if(!Te(e))throw new TypeError("arguments[0] is not a valid handler.");if(!Te(t))throw new TypeError("arguments[1] is not a valid handler.");e=e.bind(u);t=t.bind(u);return function(r){return(r?t:e)(this)}});t("EXECUTE_ONLY_WHEN_ALL_REQUESTED",function(e){if(!Te(e))throw new TypeError("arguments[0] is not a valid handler.");e=e.bind(u);return function(t){return t?u:e(this)}});t("EXECUTE_ONLY_WHEN_NO_REQUESTED",function(e){if(!Te(e))throw new TypeError("arguments[0] is not a valid handler.");e=e.bind(this);return function t(r){return r?e(this):null}});return At})(gt)(gt.prototype);function wt(e){this.object=e;this.__forEach=K.bind(this.entered=new s);pe(e,this)}wt.prototype=l({__forEach:null,_enter:function(e){var t=this.entered;if(t.has(e))return;e._add(this);t.add(e)},_leave:function(e){var t=this.entered;if(!t.has(e))return;e._remove(this);t.delete(e)},entered:null,object:null,enter:function(e){_e(gt,e,"arguments[0] is not an instance of Republic");this._enter(fe(e));return this.object},leave:function(e){_e(gt,e,"arguments[0] is not an instance of Republic");this._leave(fe(e));return this.object},request:function(){var e=this;e.entered.forEach(function t(r){r._remove(e)});return e.object},unrequest:function(){var e=this;e.entered.forEach(function t(r){r._add(e)});return e.object},update:function(){this.__forEach(function e(t){t.execute()});return this.object},__proto__:null});function Ct(){if(!Oe(this))return new Ct;ve(Ct,this);var e=new wt(this);we(this,Ye,e,"enter");we(this,Ge,e,"leave");we(this,Ze,e,"request");we(this,$e,e,"unrequest");we(this,Ke,e,"update")}de(Ct,function Nt(e){var t=ae(e);t("enter",null);t("leave",null);t("request",null);t("unrequest",null);t("update",null);t(Ye,null);t(Ge,null);t(Ze,null);t($e,null);t(Ke,null);return e}(l(c)));x._kJs_Civilian=R.Civilian=Ct;Ct.toString=Re;Ct.user_manuals=["constructor Civilian();","void enter(Republic set);","void leave(Republic set);","void request();","void unrequest();","void update();"];var Pt=null;function jt(){return Pt||this}jt.prototype=ut;jt.toString=Re;jt.user_manuals=["constructor Initor::SymbolCollection();","Return value: An object which contains all keys"];jt[He]=jt.created=Pt=d(new jt);d(jt);var St=null;function Et(){return St||this}Et.prototype=lt;Et.toString=Re;Et.user_manuals=["function Initor::FunctionCollection();","Return value: An object which contains all utility functions"];Et.prototype=lt;Et[He]=Et.created=St=new Et;d(Et);var Mt=new s;function kt(e){if(!Oe(e))throw new TypeError("arguments[0] must be extensible.");if(Mt.has(e))return this;Mt.add(e);re(e,k);oe(k);ie(k);return this}kt.toString=Re;kt.user_manuals=["function Initor::ReleaseMethods(Object object);","Implement all methods from -k-js-abstract.js"];p(c,Le,B);p(c,"__proto__",B);var xt=new s;function Rt(e){if(!Oe(e))throw new TypeError("arguments[0] must be extensible.");if(xt.has(e))return this;xt.add(e);re(e,x);oe(x);ie(x);te(e,"_kJs_primitivePrototype",c);te(e,Ue,c);return this}Rt.toString=Re;Rt.user_manuals=["function Initor::ReleaseClasses(Object object);","Release all classes from -k-js-abstract.js to object"];R._primitive_prototype=R[Ue]=c;var Dt=null;function Ot(){return Dt||this}Ot.prototype=d(R);Ot.toString=Re;Ot.user_manuals=["constructor Initor::ClassCollection();","Return a class collection"];Ot[He]=Ot.created=Dt=d(new Ot);d(Ot);var Tt=null;var qt=t.document.currentScript;var Jt=qt.getAttributeNS(null,"kjslib-keyword")||"_kJs_Initor";function It(){if(Tt)return Tt;var e=ae(this);e("SymbolCollection",jt);e(Ie,jt);e("FunctionCollection",Et);e(Be,Et);kt(this);e("ReleaseMethods",kt);e(Ae,kt);Rt(this);e("ReleaseClasses",Rt);e(Ne,Rt);e("ClassCollection",Ot);e(Fe,Ot);return Tt=this}t[Jt]=t[Je]=It;It.toString=Re;It.user_manuals=["constructor Initor();","This constructor is used for create initor of -k-js-abstract.js","Call this constructor once for all"];It.prototype=l(c);It[He]=It.created=Tt=d(new It);d(It);kt(c)})(window,Object,Function,Symbol,Array,Map,Set);